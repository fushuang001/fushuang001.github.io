I"ñ!<h1 id="å°†-nexus9000-nxos-image-è½¬æ¢ä¸º-aci-image">å°† Nexus9000 NXOS image è½¬æ¢ä¸º ACI image</h1>
<p><a href="https://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus9000/sw/7-x/upgrade/guide/b_Cisco_Nexus_9000_Series_NX-OS_Software_Upgrade_and_Downgrade_Guide_Release_7x/Converting_from_Cisco_NX_OS_to_ACI_Boot_Mode.pdf">å®˜æ–¹å‚è€ƒæ–‡æ¡£-è‹±æ–‡</a></p>

<blockquote>
  <p>æå‰ç¡®è®¤è®¾å¤‡æ˜¯å¦æ”¯æŒ ACI imageï¼›
å¯¹äº N9500 æœºæ¡†å¼ï¼Œæ˜¯å¦æ‰€æœ‰æ¿å¡éƒ½æ”¯æŒ ACI image</p>
</blockquote>

<p><strong>å¯¹äº RMA ç¡¬ä»¶æ›´æ¢çš„ Nexus9000ï¼Œå»ºè®®è½¬æ¢çš„ ACI image è¦æ¯”ç°ç½‘ ACI image ä½ä¸€ä¸ªç‰ˆæœ¬ï¼Œç„¶åæ¥å…¥ ACI ç¯å¢ƒï¼Œç”¨ APIC å®Œæˆæœ€ç»ˆçš„ ACI imageå‡çº§(å¦åˆ™å¯èƒ½æœ‰æƒŠå–œï¼Œæ¯”å¦‚å…‰æ¨¡å—ä¸èƒ½è¯†åˆ«)</strong></p>

<ol>
  <li>
    <p>ç»™ Nexus9000 çš„ mgmt0 æ¥å£é…ç½® ACI çš„ç®¡ç†ç½‘ IPï¼Œç¡®è®¤Nexus9000 mgmt0 æ¥å£å’Œ APIC ä¹‹é—´å¯ä»¥é€šä¿¡(ä¸éœ€è¦æ¥Nexus9000 ä¸šåŠ¡å£åˆ° ACI). å¦‚æœä¸å¸Œæœ›ä» APIC copy ACI imageï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ U ç›˜ã€‚</p>
  </li>
  <li>
    <p>è¾“å…¥å‘½ä»¤<code class="highlighter-rouge">feature scp</code> å¼€å¯ Nexus9000 çš„ SCP æœåŠ¡</p>
  </li>
  <li>
    <p>SSH ç™»å½• APIC å‘½ä»¤è¡Œï¼Œè¾“å…¥å‘½ä»¤<code class="highlighter-rouge">scp -r /firmware/fwrepos/fwrepo/switch-image-name admin@switch-ip-address:switch-image-name</code> æŠŠ image ä¼ ç»™ Nexus9000</p>
  </li>
  <li>
    <p>Nexus9000 è¾“å…¥å‘½ä»¤ <code class="highlighter-rouge">no boot nxos</code>, <code class="highlighter-rouge">copy run startup</code> æ¥å¿½ç•¥ NXOS å¯åŠ¨é•œåƒ</p>
  </li>
  <li>
    <p>Nexus9000 è¾“å…¥å‘½ä»¤ <code class="highlighter-rouge">boot aci bootflash:aci-image-name</code>  æ¥è®¾ç½® ACI image ä¸ºé‡å¯ä¹‹åçš„é•œåƒæºï¼›è¿™ä¸€æ­¥<strong>ä¸èƒ½</strong><code class="highlighter-rouge">copy run startup</code></p>
  </li>
  <li>
    <p>Nexus9000 è¾“å…¥å‘½ä»¤<code class="highlighter-rouge">show file bootflash:aci-image-name md5sum</code> æ£€æŸ¥ ACI image çš„ MD5 å€¼</p>
  </li>
  <li>
    <p>Nexus9000 è¾“å…¥å‘½ä»¤ <code class="highlighter-rouge">reload</code> æ¥é‡å¯ï¼Œå¯åŠ¨ä¹‹åä½¿ç”¨<code class="highlighter-rouge">admin</code> ç™»å½•ï¼›è‹¥æ— å¼‚å¸¸ï¼Œå¯ä»¥å°†è®¾å¤‡æ¥å…¥ ACI Fabric</p>
  </li>
</ol>

<p><strong>å…³äºæƒŠå–œ-FPGA/EPLD éœ€è¦å•ç‹¬å‡çº§</strong></p>

<ol>
  <li>
    <p>å¶å°”å®¢æˆ·ä¼šå‘ç° convert to ACI image ä¹‹åï¼Œleaf ä¸Šè”å£æ’å…¥å…‰æ¨¡å—ï¼Œæ¥å£ downï¼›ä½†æ˜¯ç¡®è®¤åœ¨ NXOS imageï¼Œæ¥å£å¥½ç”¨</p>
  </li>
  <li><code class="highlighter-rouge">show interface ex/y</code> å¯èƒ½æ˜¾ç¤º <code class="highlighter-rouge">sfp-missing</code>, æ¥ä¸‹æ¥æŸ¥çœ‹ Nexus9000 <code class="highlighter-rouge">moquery -c firmwareARunning</code> å¦‚æœå‘ç°ç±»ä¼¼äºä¸‹é¢çš„è¾“å…¥ï¼Œé‚£ä¹ˆç¡®è®¤ä¸­å¥–
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># firmware.CompRunning
childAction    :
descr          :
dn             : sys/ch/supslot-1/sup/fpga-1/running
expectedVer    : 0x20
internalLabel  :
modTs          : never
mode           : normal
monPolDn       : uni/fabric/monfab-default
operSt         : ver-mismatch  &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; æœŸæœ› 0x20, å®é™… 0x17
rn             : running
status         :
ts             : 1970-01-01T00:00:00.000+00:00
type           : controller
version        : 0x17
</code></pre></div>    </div>
  </li>
  <li>FPGA æ˜¯ç¡¬ä»¶å¯ç¼–ç¨‹èŠ¯ç‰‡ï¼Œè‹¥ version mismatchï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¥å£é—®é¢˜ã€‚ç›®å‰å› ä¸ºæ˜¯æ‰‹åŠ¨ è½¬æ¢/å‡çº§ ACI image çš„ï¼ŒFPGA å¯èƒ½æ²¡æœ‰éšç€ä¸€èµ·å‡çº§ã€‚å¯ä»¥æŒ‰ç…§ä¸‹é¢æ–¹å¼æ¢å¤
    <ol>
      <li>
        <p>convert back to NXOS image, æ‰‹åŠ¨å‡çº§ EPLD/FPGA</p>
      </li>
      <li>
        <p>æ¯”å¦‚ ACI image ç›®æ ‡ç‰ˆæœ¬ä¸º 3.2.5d, å¯ä»¥é™çº§åˆ° 3.2.2oï¼Œç„¶åç”¨ APIC ç»™ leaf å‡çº§</p>
      </li>
      <li>
        <p>åœ¨ ACI imageï¼Œleaf è¾“å…¥å‘½ä»¤ <code class="highlighter-rouge">/bin/check-fpga.sh FpGaDoWnGrAdE</code>, ç„¶å <code class="highlighter-rouge">/usr/sbin/chassis-power-cycle.sh</code> ï¼Œç„¶åé‡å¯ï¼Œçœ‹æ˜¯å¦èƒ½è§£å†³</p>
      </li>
      <li>
        <p>å¦‚æœä»¥ä¸Šæ–¹å¼å‡ä¸å¥½ç”¨ï¼Œdonâ€™t worryï¼Œå¼€ case ç»™ Cisco TACï¼Œè¿˜æœ‰äº›å…¶ä»–æ–¹å¼å¯ç”¨ï¼Œä½†æ˜¯éœ€è¦ root æƒé™</p>
      </li>
      <li>
        <p>å¦‚æœè®¾å¤‡æ²¡æœ‰åˆåŒæˆ–è€…ä¸æƒ³å¼€ case æ€ä¹ˆåŠï¼Œå¯ä»¥è¯•ç€è”ç³»æˆ‘ ğŸ¤”</p>
      </li>
    </ol>
  </li>
</ol>

<hr />

<h1 id="å°†-aci-image-è½¬æ¢ä¸º-standalone-nxos-image">å°† ACI image è½¬æ¢ä¸º standalone NXOS image</h1>
<p><a href="https://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus9000/sw/7-x/upgrade/guide/b_Cisco_Nexus_9000_Series_NX-OS_Software_Upgrade_and_Downgrade_Guide_Release_7x/Converting_from_Cisco_NX_OS_to_ACI_Boot_Mode.pdf">å®˜æ–¹å‚è€ƒæ–‡æ¡£-è‹±æ–‡</a></p>

<p>ç›´æ¥æŸ¥æ‰¾ <strong>Converting Back to Cisco NX-OS</strong></p>

<ol>
  <li>
    <p>ä¸€èˆ¬æ¥è¯´ï¼ŒACI image çš„ Nexus9000 bootflash ä¸­å¦‚æœæ²¡æœ‰ NXOS é•œåƒï¼Œéœ€è¦å€ŸåŠ© U ç›˜ï¼Œå°† NXOS é•œåƒæ”¾å…¥ U ç›˜ï¼›</p>
  </li>
  <li>
    <p>æ¥ä¸Š consoleçº¿ï¼Œé‡å¯ ACI image çš„ Nexus9000ï¼ŒæŒ‰ä¸‹ <kbd>Ctrl</kbd> + <kbd>C</kbd> æˆ–è€…<kbd> Ctrl</kbd> + <kbd>]</kbd> ä¸­æ–­å¯åŠ¨è¿‡ç¨‹ï¼Œè¿›å…¥ <code class="highlighter-rouge">loader&gt;</code> æ¨¡å¼</p>
  </li>
  <li>
    <p>è¾“å…¥å‘½ä»¤<code class="highlighter-rouge">cmdline recoverymode=1</code></p>
  </li>
  <li>
    <p>è¾“å…¥å‘½ä»¤ <code class="highlighter-rouge">dir</code>  æ¥æŸ¥çœ‹æ˜¯å¦å­˜åœ¨å¯ç”¨çš„ NXOS å¯åŠ¨é•œåƒ</p>
  </li>
  <li>
    <p>è¾“å…¥å‘½ä»¤<code class="highlighter-rouge">boot nxos.7.0.3.I7.6.bin</code>å¯åŠ¨ NXOS imageï¼Œè‹¥ä» bootflash å¯åŠ¨ï¼Œè¾“å…¥å‘½ä»¤<code class="highlighter-rouge">boot usb1:nxos.7.0.3.I7.6.bin</code></p>
  </li>
  <li>
    <p>å®Œæˆ NXOS image å¯åŠ¨ä¹‹åï¼Œå»ºè®®å†æ–­ç”µé‡å¯ä¸€æ¬¡ï¼Œä¿è¯é‡å¯è¿‡ç¨‹é¡ºåˆ©è¿›å…¥ NXOS.</p>
  </li>
</ol>

<p><strong>ä¸¾ä¸ªæ —å­</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Converting ACI Back to Cisco NX-OS
bootflash NOT have any nxos image, need to recovery from USB disk

 ---------------------------- 
 Aborting config file read and autoboot
 ---------------------------- 
No autoboot or failed autoboot. falling to loader



                Loader Version 7.65

loader &gt;

 ---------------------------- 
 loader &gt; cmdline recoverymode=1
 loader &gt; boot nxos.7.0.3.I7.6.bin 
 ---------------------------- 
Booting nxos.7.0.3.I7.6.bin
Trying diskboot
 Filesystem type is ext2fs, partition type 0x83
Boot failed

Error 9: Unknown boot failure

 ---------------------------- 
 loader &gt; dir
 ---------------------------- 

usb1::
 nxos.7.0.3.I7.6.bin

bootflash::
  aci-n9000-dk9.13.1.2m.bin
loader &gt;

 ---------------------------- 
 loader &gt; boot usb1:nxos.7.0.3.I7.6.bin
 ---------------------------- 
Booting usb1:nxos.7.0.3.I7.6.bin
Trying diskboot
 Filesystem type is fat, partition type 0xc
Image valid

Saving image for img-sync ...
Found /mnt/pss/rtdbctrl.log, migrating to /mnt/pss/xlog/
Loading system software

Cisco Nexus Operating System (NX-OS) Software
TAC support: http://www.cisco.com/tac
Copyright (C) 2002-2019, Cisco and/or its affiliates.
All rights reserved.

switch(boot)#
switch(boot)#
---------------------------- 
switch(boot)# init system 

This command is going to erase your startup-config, licenses as well as the contents of your bootflash:.
Do you want to continue? (y/n)  [n] y
----------------------------

Initializing the system ...
Checking flash ...

Initialization completed.
switch(boot)#
switch(boot)#
---------------------------- 
switch(boot)# load-nxos
---------------------------- 

Unsquashing rootfs ...

---------------------------- 
after boot up with NXOS, suggest to reload again
---------------------------- 

Abort Power On Auto Provisioning [yes - continue with normal setup, skip - bypass password and basic configuration, no - continue with Power On Auto Provisioning] (yes/skip/no)[no]: yes
Disabling POAP.......Disabling POAP


         ---- System Admin Account Setup ----


Do you want to enforce secure password standard (yes/no) [y]:

  Enter the password for "admin":
  Confirm the password for "admin":
  
2019 May 23 16:59:35 switch %$ VDC-1 %$ %COPP-2-COPP_POLICY: Control-Plane is protected with policy copp-system-p-policy-strict.

User Access Verification
 login: admin
Password:
</code></pre></div></div>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nt">p</span><span class="p">{</span><span class="nl">color</span><span class="p">:</span><span class="no">green</span><span class="p">}</span>
	<span class="err">è½¬è½½å¿…é¡»æ³¨æ˜åŸæ–‡é“¾æ¥</span>
</code></pre></div></div>
:ET